apiVersion: automation.cloudbees.io/v1alpha1
kind: workflow
name: reusable-with-dynamic-environment

on:
  workflow_call:
    inputs:
      environment:
        type: string
        required: true

jobs:
  use-environment:
    environment: pg-prod
    steps:
      - uses: docker://alpine:3.21
        run: |
          set -x
          [ "$ENVSECRET" = 'use me only for prod' ]
          [ '${{ vars.env_only_int_prop }}' = '999' ]
        env:
          ENVSECRET: ${{ secrets.env_only_secret_prop }}